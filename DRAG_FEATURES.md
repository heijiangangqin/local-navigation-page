# 拖拽功能详细说明

## 🎯 功能概述

本项目支持两种拖拽排序功能：
1. **卡片拖拽排序** - 重新排列应用卡片
2. **小部件拖拽排序** - 重新排列天气、日历、记事本、待办事项小部件

## 🖱️ 卡片拖拽功能

### 使用方法
1. 将鼠标悬停在卡片上
2. 左上角会显示拖拽手柄（⋮⋮）
3. 点击并拖拽手柄或直接拖拽卡片
4. 将卡片拖拽到目标位置
5. 释放鼠标完成排序

### 视觉反馈
- **悬停状态**: 卡片上浮，显示拖拽手柄
- **拖拽状态**: 卡片半透明，旋转5度
- **目标状态**: 目标位置显示蓝色虚线边框，轻微放大

### 技术实现
- 使用HTML5原生拖拽API
- 支持触摸设备拖拽
- 自动保存排序结果到localStorage

## 🔄 小部件拖拽功能

### 支持的小部件
- 🌤️ 天气小部件
- 📅 日历小部件  
- 📝 记事本小部件
- ✅ 待办事项小部件

### 使用方法
1. 将鼠标悬停在小部件上
2. 右上角会显示拖拽手柄（⋮⋮）
3. 点击并拖拽手柄或直接拖拽小部件
4. 将小部件拖拽到目标位置
5. 释放鼠标完成排序

### 智能交互处理
- **输入框保护**: 点击输入框不会触发拖拽
- **按钮保护**: 点击按钮不会触发拖拽
- **文本区域保护**: 点击文本区域不会触发拖拽
- **拖拽手柄**: 专门用于拖拽操作

### 视觉反馈
- **悬停状态**: 小部件上浮，显示拖拽手柄
- **拖拽状态**: 小部件半透明，旋转2度
- **目标状态**: 目标位置显示蓝色虚线边框，轻微放大

## 🧪 测试页面

### 卡片拖拽测试
文件: `test-drag.html`
- 独立的卡片拖拽测试环境
- 支持添加/清空测试卡片
- 控制台日志输出
- 实时排序验证

### 小部件拖拽测试
文件: `test-widget-drag.html`
- 独立的小部件拖拽测试环境
- 包含所有四种小部件类型
- 测试输入框和按钮交互
- 显示当前小部件顺序
- 重置功能

## 💾 数据持久化

### 卡片排序
- 存储键: `homepage_cards`
- 格式: JSON数组
- 自动保存: 拖拽完成后立即保存

### 小部件排序
- 存储键: `homepage_widget_order`
- 格式: JSON数组（小部件类型名称）
- 自动保存: 拖拽完成后立即保存
- 自动加载: 页面加载时恢复排序

## 🎨 样式定制

### CSS类名
- `.dragging` - 拖拽状态
- `.drag-over` - 目标状态
- `.card-drag-handle` - 卡片拖拽手柄
- `.widget-drag-handle` - 小部件拖拽手柄

### 自定义样式
可以通过修改CSS来自定义拖拽效果：
```css
/* 自定义拖拽透明度 */
.card.dragging, .widget.dragging {
    opacity: 0.6;
}

/* 自定义拖拽旋转角度 */
.card.dragging {
    transform: rotate(3deg);
}

.widget.dragging {
    transform: rotate(1deg);
}

/* 自定义目标边框颜色 */
.card.drag-over, .widget.drag-over {
    border-color: #ff6b6b;
}
```

## 🔧 技术细节

### 事件处理
- `dragstart` - 开始拖拽
- `dragend` - 结束拖拽
- `dragover` - 拖拽悬停
- `drop` - 放置元素
- `dragenter` - 进入目标区域
- `dragleave` - 离开目标区域

### 兼容性
- **现代浏览器**: 完全支持
- **移动设备**: 支持触摸拖拽
- **旧版浏览器**: 降级为静态布局

### 性能优化
- 使用事件委托减少事件监听器
- 延迟保存避免频繁localStorage操作
- CSS硬件加速提升动画性能

## 🐛 故障排除

### 常见问题
1. **拖拽不工作**: 检查浏览器是否支持HTML5拖拽API
2. **排序不保存**: 检查localStorage是否可用
3. **输入框冲突**: 确保点击的是拖拽手柄或小部件区域
4. **视觉反馈异常**: 检查CSS样式是否正确加载

### 调试方法
1. 打开浏览器开发者工具
2. 查看控制台日志输出
3. 检查localStorage数据
4. 使用测试页面验证功能

## 📱 移动端支持

### 触摸拖拽
- 支持触摸设备拖拽操作
- 长按启动拖拽模式
- 触摸反馈优化

### 响应式设计
- 拖拽手柄在小屏幕上自动调整大小
- 拖拽区域适配不同屏幕尺寸
- 触摸友好的交互设计

---

**享受您的拖拽排序体验！** 🎉 